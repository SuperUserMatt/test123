<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Careers - Join Our Team!</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f8fafc; /* Light gray background */
        }
        /* Custom scrollbar for job description */
        .job-description-content {
            max-height: 70vh; /* Limit height to prevent overflow */
            overflow-y: auto; /* Enable scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            scrollbar-width: thin; /* Firefox */
            scrollbar-color: #cbd5e1 #f1f5f9; /* Firefox */
        }
        .job-description-content::-webkit-scrollbar {
            width: 8px;
        }
        .job-description-content::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 10px;
        }
        .job-description-content::-webkit-scrollbar-thumb {
            background-color: #cbd5e1;
            border-radius: 10px;
            border: 2px solid #f1f5f9;
        }
        /* Styles to make Greenhouse embedded content responsive */
        .greenhouse-content iframe {
            width: 100%;
            height: 100vh; /* Adjust as needed */
            border: none;
        }
    </style>
</head>
<body class="p-4 sm:p-8 bg-gray-50 text-gray-800">
    <div class="max-w-5xl mx-auto bg-white shadow-lg rounded-xl p-6 sm:p-8 md:p-10">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center text-blue-800 mb-8 sm:mb-10">
            Join Our Team!
        </h1>

        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="text-center text-blue-600 text-lg font-medium hidden">
            Loading jobs...
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="text-center text-red-600 text-lg font-medium hidden">
            Failed to load jobs. Please try again later.
        </div>

        <!-- Job Listings Section -->
        <div id="jobListings" class="space-y-4">
            <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-6">Open Positions</h2>
            <div id="jobsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Job cards will be inserted here by JavaScript -->
            </div>
        </div>

        <!-- Job Detail Section (Initially Hidden) -->
        <div id="jobDetail" class="hidden mt-8">
            <button id="backToListButton"
                    class="mb-6 px-5 py-2 bg-blue-600 text-white rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                &larr; Back to All Jobs
            </button>
            <h2 id="jobTitle" class="text-3xl sm:text-4xl font-bold text-gray-900 mb-4"></h2>
            <p id="jobLocation" class="text-lg text-gray-600 mb-2"></p>
            <p id="jobDepartment" class="text-lg text-gray-600 mb-6"></p>

            <div class="bg-gray-50 rounded-lg p-6 shadow-inner job-description-content">
                <div id="jobDescription" class="prose max-w-none text-gray-700">
                    <!-- Job description will be inserted here by JavaScript -->
                </div>
            </div>

            <div class="mt-8 text-center">
                <a id="applyNowButton" target="_blank" rel="noopener noreferrer"
                   class="inline-block px-8 py-3 bg-green-600 text-white font-semibold rounded-full shadow-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75 transition duration-200 ease-in-out transform hover:scale-105">
                    Apply Now
                </a>
            </div>
        </div>
    </div>

    <script>
        // *** IMPORTANT: Replace 'YOUR_GREENHOUSE_BOARD_TOKEN' with your actual token ***
        const GREENHOUSE_BOARD_TOKEN = 'matthewmeliasdemoaccount'; 
        const API_BASE_URL = `https://boards-api.greenhouse.io/v1/boards/${GREENHOUSE_BOARD_TOKEN}`;

        const jobsContainer = document.getElementById('jobsContainer');
        const jobListingsSection = document.getElementById('jobListings');
        const jobDetailSection = document.getElementById('jobDetail');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const errorMessage = document.getElementById('errorMessage');
        const backToListButton = document.getElementById('backToListButton');
        const jobTitleElem = document.getElementById('jobTitle');
        const jobLocationElem = document.getElementById('jobLocation');
        const jobDepartmentElem = document.getElementById('jobDepartment');
        const jobDescriptionElem = document.getElementById('jobDescription');
        const applyNowButton = document.getElementById('applyNowButton');

        // Function to show/hide sections
        function showSection(sectionId) {
            jobListingsSection.classList.add('hidden');
            jobDetailSection.classList.add('hidden');
            loadingIndicator.classList.add('hidden');
            errorMessage.classList.add('hidden');

            if (sectionId === 'loading') {
                loadingIndicator.classList.remove('hidden');
            } else if (sectionId === 'error') {
                errorMessage.classList.remove('hidden');
            } else if (sectionId === 'jobListings') {
                jobListingsSection.classList.remove('hidden');
            } else if (sectionId === 'jobDetail') {
                jobDetailSection.classList.remove('hidden');
            }
        }

        // Function to fetch all jobs
        async function fetchJobs() {
            showSection('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/jobs?content=true`); // content=true to get descriptions
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                displayJobs(data.jobs);
                showSection('jobListings');
            } catch (error) {
                console.error('Error fetching jobs:', error);
                errorMessage.textContent = 'Failed to load job listings. Please check your board token.';
                showSection('error');
            }
        }

        // Function to display job listings
        function displayJobs(jobs) {
            jobsContainer.innerHTML = ''; // Clear previous listings
            if (jobs.length === 0) {
                jobsContainer.innerHTML = '<p class="text-center text-gray-600 col-span-full">No open positions at this time. Please check back later!</p>';
                return;
            }

            // Sort jobs by title for consistent display
            jobs.sort((a, b) => a.title.localeCompare(b.title));

            jobs.forEach(job => {
                const jobCard = document.createElement('div');
                jobCard.classList.add(
                    'bg-white', 'rounded-lg', 'shadow-md', 'p-6', 'cursor-pointer',
                    'hover:shadow-lg', 'hover:border-blue-300', 'border-2', 'border-transparent',
                    'transition', 'duration-200', 'ease-in-out', 'transform', 'hover:-translate-y-1'
                );
                jobCard.innerHTML = `
                    <h3 class="text-xl font-semibold text-blue-700 mb-2">${job.title}</h3>
                    <p class="text-gray-600 text-sm mb-1">${job.location.name}</p>
                    ${job.departments.length > 0 ? `<p class="text-gray-500 text-sm">${job.departments[0].name}</p>` : ''}
                `;
                jobCard.addEventListener('click', () => fetchAndDisplayJobDetail(job.id));
                jobsContainer.appendChild(jobCard);
            });
        }

        // Function to fetch and display single job detail
        async function fetchAndDisplayJobDetail(jobId) {
            showSection('loading');
            try {
                const response = await fetch(`${API_BASE_URL}/jobs/${jobId}?content=true`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const job = await response.json();
                
                jobTitleElem.textContent = job.title;
                jobLocationElem.textContent = job.location.name;
                jobDepartmentElem.textContent = job.departments.length > 0 ? job.departments[0].name : '';
                
                // Set the HTML content for the description
                jobDescriptionElem.innerHTML = job.content;
                
                applyNowButton.href = job.absolute_url;
                
                showSection('jobDetail');
            } catch (error) {
                console.error(`Error fetching job detail for ID ${jobId}:`, error);
                errorMessage.textContent = 'Failed to load job details. Please try again later.';
                showSection('error');
            }
        }

        // Event listener for the "Back to All Jobs" button
        backToListButton.addEventListener('click', () => {
            fetchJobs(); // Re-fetch to ensure fresh list, or could optimize by just showing the cached list
        });

        // Initial load of jobs when the page loads
        document.addEventListener('DOMContentLoaded', fetchJobs);
    </script>
</body>
</html>